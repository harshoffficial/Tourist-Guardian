<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Tourist Guardian Map</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body, html {
            width: 100%;
            height: 100%;
            overflow: hidden;
            font-family: Arial, sans-serif;
        }
        #map {
            width: 100%;
            height: 100%;
        }
        .legend {
            position: absolute;
            bottom: 30px;
            right: 10px;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            z-index: 1000;
            max-width: 200px;
            font-size: 12px;
        }
        .legend h3 {
            margin: 0 0 10px 0;
            font-size: 14px;
            font-weight: bold;
        }
        .legend-item {
            margin: 5px 0;
            display: flex;
            align-items: center;
        }
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 8px;
            border: 2px solid #333;
        }
        .toggle-buttons {
            position: absolute;
            bottom: 30px;
            right: 230px;
            z-index: 1000;
            background: white;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            min-width: 150px;
        }
        .toggle-btn {
            display: block;
            margin: 5px 0;
            padding: 8px 12px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            width: 100%;
        }
        .toggle-btn.active {
            background: #45a049;
        }
        .toggle-btn.inactive {
            background: #ccc;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    
    <div class="toggle-buttons">
        <button class="toggle-btn active" onclick="toggleLayer('wildlife')">Wildlife Conflict</button>
        <button class="toggle-btn active" onclick="toggleLayer('crime')">Crime Hotspots</button>
        <button class="toggle-btn active" onclick="toggleLayer('landslide')">Landslide Areas</button>
    </div>
    
    <div class="legend">
        <h3>Danger Zones</h3>
        <div class="legend-item">
            <div class="legend-color" style="background: #ff4444; border-color: #cc0000;"></div>
            <span>Wildlife Conflict</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #8b0000; border-color: #660000;"></div>
            <span>Crime Hotspots</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #d2691e; border-color: #8b4513;"></div>
            <span>Landslide Areas</span>
        </div>
    </div>
    
    <!-- Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <script>
        let map;
        let marker;
        let layers = {
            wildlife: [],
            crime: [],
            landslide: []
        };
        let animationFrames = [];
        
        // Create animated pulsing circle with fade effect
        function createAnimatedCircle(lat, lng, radius, color, fillColor, type) {
            const circles = [];
            const baseRadius = radius * 1000; // Convert km to meters
            const spreadFactor = 1.4; // Make circles spread 40% more
            
            // Create multiple concentric circles for fade effect
            const numLayers = 4;
            for (let i = 0; i < numLayers; i++) {
                const layerRadius = baseRadius * spreadFactor * (1 + i * 0.3);
                const opacity = 0.4 - (i * 0.1); // Decrease opacity for outer layers
                
                const circle = L.circle([lat, lng], {
                    color: color,
                    fillColor: fillColor,
                    fillOpacity: opacity,
                    weight: 2 - (i * 0.3),
                    radius: layerRadius
                }).addTo(map);
                
                circles.push(circle);
            }
            
            // Animation function for pulsing effect
            let pulseDirection = 1;
            let currentPulse = 0;
            const pulseSpeed = 0.02;
            const maxPulse = 0.3;
            
            function animate() {
                currentPulse += pulseDirection * pulseSpeed;
                
                if (currentPulse >= maxPulse) {
                    pulseDirection = -1;
                } else if (currentPulse <= 0) {
                    pulseDirection = 1;
                }
                
                circles.forEach((circle, index) => {
                    const baseOpacity = 0.4 - (index * 0.1);
                    const pulseOpacity = baseOpacity + (currentPulse * (1 - index * 0.2));
                    const pulseRadius = baseRadius * spreadFactor * (1 + index * 0.3) * (1 + currentPulse * 0.1);
                    
                    circle.setStyle({
                        fillOpacity: Math.max(0.1, Math.min(0.6, pulseOpacity)),
                        radius: pulseRadius
                    });
                });
                
                animationFrames.push(requestAnimationFrame(animate));
            }
            
            animate();
            return circles;
        }
        
        // Wildlife Conflict Areas (15 points)
        const wildlifeAreas = [
            {name: "Kaziranga National Park", lat: 26.52535, lng: 92.99242, radius: 15, info: "Rhino/Elephant/Tiger HWC"},
            {name: "Tadoba–Andhari", lat: 20.26667, lng: 79.40000, radius: 12, info: "Tiger attack hotspot"},
            {name: "Sundarbans", lat: 21.945, lng: 88.895, radius: 25, info: "Man-tiger conflict"},
            {name: "Bandipur / Nilgiri", lat: 11.66167, lng: 76.62722, radius: 18, info: "Elephant & carnivore movement"},
            {name: "Nagarhole (Kabini)", lat: 12.0314, lng: 76.1207, radius: 15, info: "Tourist/edge conflict zones"},
            {name: "Jim Corbett National Park", lat: 29.54860, lng: 78.93530, radius: 18, info: "Core + buffer villages"},
            {name: "Ranthambore", lat: 26.01733, lng: 76.50257, radius: 12, info: "Park core + fringe farmland"},
            {name: "Periyar", lat: 9.5775, lng: 77.1800, radius: 12, info: "Hilly forest + plantations"},
            {name: "Manas National Park", lat: 26.7167, lng: 91.0000, radius: 18, info: "Transboundary conflict zones"},
            {name: "Kanha", lat: 22.3348, lng: 80.6116, radius: 14, info: "Buffer farmland interface"},
            {name: "Dudhwa / Terai", lat: 28.4186, lng: 80.1531, radius: 15, info: "Elephant/tiger incidents"},
            {name: "Simlipal", lat: 21.7896, lng: 86.1208, radius: 12, info: "Reserve + fringe villages"},
            {name: "Nameri / Sonai Rupai", lat: 26.8750, lng: 92.8833, radius: 10, info: "Elephant/tiger movement"},
            {name: "Buxa / Dooars", lat: 26.7000, lng: 89.5000, radius: 12, info: "Tea garden/forest edges"},
            {name: "Kabini–Bangalore fringe", lat: 12.0000, lng: 76.6000, radius: 12, info: "Corridor/settlement clashes"}
        ];
        
        // Crime Hotspots (15 points)
        const crimeAreas = [
            {name: "Kochi", lat: 9.9312, lng: 76.2673, radius: 10, info: "Highest crime-rate metro"},
            {name: "Delhi (NCT)", lat: 28.6139, lng: 77.2090, radius: 25, info: "Large metro - high crime"},
            {name: "Surat", lat: 21.1702, lng: 72.8311, radius: 12, info: "High crime rate"},
            {name: "Jaipur", lat: 26.9124, lng: 75.7873, radius: 12, info: "High crime rate"},
            {name: "Patna", lat: 25.5941, lng: 85.1376, radius: 10, info: "High crime rate"},
            {name: "Indore", lat: 22.7196, lng: 75.8577, radius: 12, info: "High crime rate"},
            {name: "Lucknow", lat: 26.8467, lng: 80.9462, radius: 12, info: "High crime rate"},
            {name: "Nagpur", lat: 21.1458, lng: 79.0882, radius: 10, info: "Violent-crime surge"},
            {name: "Kozhikode", lat: 11.2588, lng: 75.7804, radius: 9, info: "High crime rate"},
            {name: "Ahmedabad", lat: 23.0225, lng: 72.5714, radius: 18, info: "High crime rate"},
            {name: "Faridabad", lat: 28.4089, lng: 77.3178, radius: 10, info: "High murder stats"},
            {name: "Ludhiana", lat: 30.9010, lng: 75.8573, radius: 10, info: "Murder hotspot"},
            {name: "Asansol", lat: 23.6828, lng: 86.9626, radius: 9, info: "High crime rate"},
            {name: "Agra", lat: 27.1767, lng: 78.0081, radius: 10, info: "High crime rate"},
            {name: "Gwalior", lat: 26.2183, lng: 78.1828, radius: 10, info: "High crime rate"}
        ];
        
        // Landslide-Prone Areas (10 points)
        const landslideAreas = [
            {name: "Rudraprayag", lat: 30.2833, lng: 79.0333, radius: 20, info: "Most landslide-prone"},
            {name: "Tehri Garhwal", lat: 30.2989, lng: 78.4856, radius: 20, info: "Landslide-prone"},
            {name: "Chamoli / Rishiganga", lat: 30.4750, lng: 79.3750, radius: 20, info: "Valley instability"},
            {name: "Sikkim (Gangtok)", lat: 27.3370, lng: 88.6165, radius: 20, info: "Steep terrain"},
            {name: "Mizoram (Aizawl)", lat: 23.1645, lng: 92.9376, radius: 25, info: "High landslide counts"},
            {name: "Idukki / Western Ghats", lat: 9.8947, lng: 77.2042, radius: 15, info: "Hilly plantations"},
            {name: "Nilgiris / Kodaikanal", lat: 11.4000, lng: 76.7000, radius: 13, info: "Western Ghats"},
            {name: "Arunachal Himalayan", lat: 28.2167, lng: 94.6667, radius: 20, info: "Monsoon-triggered"},
            {name: "Darjeeling", lat: 27.0370, lng: 88.2627, radius: 15, info: "Hills - landslide-prone"},
            {name: "Tripura (Agartala)", lat: 23.9408, lng: 91.9882, radius: 16, info: "High landslide counts"}
        ];
        
        // Initialize map (will be centered when location is received)
        function initMap(lat, lng) {
            if (map) {
                updateLocation(lat, lng);
                return;
            }
            
            // Create map centered on location
            map = L.map('map').setView([lat, lng], 7); // Start zoomed out to see India
            
            // Add OpenStreetMap tiles
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '© OpenStreetMap contributors',
                maxZoom: 19
            }).addTo(map);
            
            // Add marker for current location
            marker = L.marker([lat, lng], {
                title: 'Your Current Location',
                draggable: false
            }).addTo(map);
            
            marker.bindPopup('Your Location<br>Lat: ' + lat.toFixed(6) + '<br>Lng: ' + lng.toFixed(6)).openPopup();
            
            // Add all danger zones
            addWildlifeAreas();
            addCrimeAreas();
            addLandslideAreas();
        }
        
        // Add Wildlife Conflict Areas
        function addWildlifeAreas() {
            wildlifeAreas.forEach(area => {
                // Create animated pulsing circles
                const circles = createAnimatedCircle(
                    area.lat, 
                    area.lng, 
                    area.radius, 
                    '#cc0000', 
                    '#ff4444',
                    'wildlife'
                );
                
                // Add marker
                const marker = L.marker([area.lat, area.lng], {
                    icon: L.divIcon({
                        className: 'wildlife-marker',
                        html: '<div style="background: #ff4444; width: 12px; height: 12px; border-radius: 50%; border: 2px solid #cc0000; box-shadow: 0 0 8px rgba(255, 68, 68, 0.8);"></div>',
                        iconSize: [12, 12]
                    })
                }).addTo(map);
                
                marker.bindPopup('<b>' + area.name + '</b><br>' + area.info + '<br>Radius: ' + area.radius + ' km');
                
                circles.forEach(circle => layers.wildlife.push(circle));
                layers.wildlife.push(marker);
            });
        }
        
        // Add Crime Hotspots
        function addCrimeAreas() {
            crimeAreas.forEach(area => {
                // Create animated pulsing circles
                const circles = createAnimatedCircle(
                    area.lat, 
                    area.lng, 
                    area.radius, 
                    '#660000', 
                    '#8b0000',
                    'crime'
                );
                
                // Add marker
                const marker = L.marker([area.lat, area.lng], {
                    icon: L.divIcon({
                        className: 'crime-marker',
                        html: '<div style="background: #8b0000; width: 12px; height: 12px; border-radius: 50%; border: 2px solid #660000; box-shadow: 0 0 8px rgba(139, 0, 0, 0.8);"></div>',
                        iconSize: [12, 12]
                    })
                }).addTo(map);
                
                marker.bindPopup('<b>' + area.name + '</b><br>' + area.info + '<br>Radius: ' + area.radius + ' km');
                
                circles.forEach(circle => layers.crime.push(circle));
                layers.crime.push(marker);
            });
        }
        
        // Add Landslide Areas
        function addLandslideAreas() {
            landslideAreas.forEach(area => {
                // Create animated pulsing circles
                const circles = createAnimatedCircle(
                    area.lat, 
                    area.lng, 
                    area.radius, 
                    '#8b4513', 
                    '#d2691e',
                    'landslide'
                );
                
                // Add marker
                const marker = L.marker([area.lat, area.lng], {
                    icon: L.divIcon({
                        className: 'landslide-marker',
                        html: '<div style="background: #d2691e; width: 12px; height: 12px; border-radius: 50%; border: 2px solid #8b4513; box-shadow: 0 0 8px rgba(210, 105, 30, 0.8);"></div>',
                        iconSize: [12, 12]
                    })
                }).addTo(map);
                
                marker.bindPopup('<b>' + area.name + '</b><br>' + area.info + '<br>Radius: ' + area.radius + ' km');
                
                circles.forEach(circle => layers.landslide.push(circle));
                layers.landslide.push(marker);
            });
        }
        
        // Toggle layer visibility
        function toggleLayer(type) {
            const btn = event.target;
            const isActive = btn.classList.contains('active');
            
            layers[type].forEach(layer => {
                if (isActive) {
                    map.removeLayer(layer);
                    btn.classList.remove('active');
                    btn.classList.add('inactive');
                } else {
                    map.addLayer(layer);
                    btn.classList.add('active');
                    btn.classList.remove('inactive');
                }
            });
        }
        
        // Update location on map
        function updateLocation(lat, lng) {
            if (!map) {
                initMap(lat, lng);
                return;
            }
            
            if (marker) {
                marker.setLatLng([lat, lng]);
                marker.bindPopup('Your Location<br>Lat: ' + lat.toFixed(6) + '<br>Lng: ' + lng.toFixed(6)).openPopup();
            }
            
            // Center map on location but keep zoom level
            map.setView([lat, lng], map.getZoom());
        }
        
        // Handle location updates from Android
        function onLocationUpdate(lat, lng) {
            console.log('Location received: ' + lat + ', ' + lng);
            updateLocation(lat, lng);
        }
        
        // Clean up animations on page unload
        window.addEventListener('beforeunload', () => {
            animationFrames.forEach(frame => cancelAnimationFrame(frame));
        });
        
        // Listen for messages from Android WebView
        if (window.AndroidInterface) {
            console.log('Android interface ready');
        }
    </script>
</body>
</html>
